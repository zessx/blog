---
layout: post
title:  "Dark mode"
date:   2020-02-19
tags:
- css
- html
- js
description: >
  Que faut-il savoir pour ajouter un dark mode sur un site ?
---

## Nice touch

Certains d'entre-vous l'aurons d√©j√† remarqu√©,
mais mon blog est d√©sormais dark mode friendly ! üéâ

Je suis un grand utilisateur des dark mode pour plusieurs raisons. D'abord pour le confort des yeux avec plus de 10 heures d'√©cran par jour, mais aussi parce que je trouve le contraste "naturellement" plus √©lev√© dans les th√®mes sombres et que l'information y est plus rapidement identifiable (je parle ici surtout de code, √©videmment). Ensuite, et m√™me si ce n'a pas toujours √©t√© vrai, la r√©duction de la consommation des √©crans est toujours √† prendre en compte. Derni√®re raison enfin, et pas des moindre‚Ä¶ *Daaaaaark !!* ü§ò

## √âvolution du dark mode

Le dark mode ne date pas d'hier. On l'utilise depuis toujours dans l'informatique, et plus particuli√®rement dans le d√©veloppement depuis plusieurs ann√©es avec l'arriv√©e de la vague d'√©diteurs de texte avanc√©s (Sublime Text, Atom, VSCode‚Ä¶). Pour plus de d√©tails sur ses origines et son √©volution, je vous renvoie au tr√®s bon article de [Olivier Berni](https://uxdesign.cc/@olivier_berni) : [The past, present, and future of Dark Mode](https://uxdesign.cc/the-past-present-and-future-of-dark-mode-9254f2956ec7).

Seulement voil√†, aujourd'hui il se d√©mocratise √† grande vitesse avec son arriv√©e dans de nombreuses applications, ainsi que dans macOS Mojave (septembre 2018), Android 10 (mars 2019), iOS 13 (septembre 2019) ou encore Chrome 78 (octobre 2019). Le support de cette pr√©f√©rence utilisateur directement dans les OS et les navigateurs permet de la d√©ployer √† un tout autre niveau : directement dans les sites web.

Sa mise en place n'est pas n√©cessairement pertinente mais peut avoir un grand int√©r√™t dans les sites √† fort contenu √©ditorial, comme ce blog par exemple.

## La media query `prefers-color-scheme`

De la m√™me mani√®re que vous pouvez d√©finir un habillage CSS sp√©cifique pour l'impression d'une page web, vous pouvez aujourd'hui en d√©finir un pour les utilisateurs ayant activ√© le dark mode. Et c'est aussi simple que √ßa :

```css
body {
    color: #333;
    background: #fff;
}

@media (prefers-color-scheme: dark) {
    body {
        color: #fff;
        background: #333;
    }
}
```

Il n'y a rien d'autre √† mettre en place, c'est support√© sur les derni√®res versions de tous les navigateurs. Encore mieux, il n'y a m√™me pas √† s'inqui√©ter des dinosaures car il s'agit la uniquement de cosm√©tique et l'absence de support de cette media query n'est en rien un frein √† l'utilisabilit√© du site web.

## Faciliter son utilisation avec Sass

Si vous utilisez le pr√©-processeur Sass vous pourrez trouver assez d√©rangeant d'avoir √† placer toutes vos media queries en dehors de vos s√©lecteurs imbriqu√©s :

```scss
.block {
    display: flex;
    justify-content: center;
    padding: 0.5em;

    &__element {
        color: $color-light;
        background: $color-primary;

        &--active {
            background: $color-primary-light;
        }
    }
}

@media (prefers-color-scheme: dark) {
    .block {
        &__element {
            background: $color-secondary;

            &--active {
                background: $color-secondary-light;
            }
        }
    }
}
```

Nous avions d√©j√† abord√© ce probl√®me lors de [pr√©c√©dents](https://blog.smarchal.com/sass-et-media-queries) [articles](https://blog.smarchal.com/sass-queries), voici donc un tout petit mixin permettant d'inclure l'habillage de votre dark mode au bon endroit (ce qui reste je le con√ßois, une question de pr√©f√©rences) :

```scss
@mixin darkmode()
{
    @media (prefers-color-scheme: dark) {
        @content;
    }
}

.block {
    display: flex;
    justify-content: center;
    padding: 0.5em;

    &__element {
        color: $color-light;
        background: $color-primary;

        @include darkmode() {
            background: $color-secondary;
        }

        &--active {
            background: $color-primary-light;

            @include darkmode() {
                background: $color-secondary-light;
            }
        }
    }
}
```

## D√©tecter le dark mode en JavaScript

Dans l'en-t√™te de ce blog, il y a (√† ce jour, en f√©vrier 2020) un canvas avec un ensemble de triangles g√©n√©r√©s √† la vol√©e. Ces triangles ont tous un fond en opacit√© de noir en temps normal, mais sur en dark mode ils n'√©taient plus vraiment visibles (opacit√© de noir sur un fond gris fonc√©), j'ai donc voulu les passer en opacit√© de blanc.

Vient alors la question : comment savoir en JavaScript si l'utilisateur utilise ou non le dark mode ?

L'interface `Window` propose justement une m√©thode `matchMedia(query)` qui va permettre de v√©rifier si la page courante correspond √† une media query, de la mani√®re suivante :

```js
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    // dark mode
} else {
    // light mode
}
```

D√®s lors, vous n'avez plus aucune limite pour la mise en place de votre dark mode !

## Tester avec Chrome

Petite astuce qui est toujours utile, Chrome permet d'√©muler cette pr√©f√©rence utilisateur rapidement. Certes, vous pourriez toujours changer vos propres pr√©f√©rences dans le navigateur, mais quand vous voulez faire des comparaison light/dark rapidement, ce n'est vraiment pas g√©rable.

Pour activer cette √©mulation :
- Allez dans les DevTools
- Ouvrez le menu de commandes via <kbd>‚åò + ‚áß + P</kbd> (ou <kbd>Ctrl + ‚áß + P</kbd> sur Windows)
- Tapez la commande "Show Rendering" et validez par <kbd>Enter</kbd>

Vous aurez ensuite acc√®s √† un nouvel onglet des DevTools, dans lequel vous pourrez changer rapidement du light mode au dark mode :

{:.center}
![Le panel Rendering des DevTools Chrome]({{ site.url }}/images/dark-mode/chrome_rendering_tab.png)

## Dernier conseil

√Ä moins que votre dark mode n'ait √©t√© pr√©vu d√®s le d√©part vous aurez forc√©ment un certains nombre de modifications √† faire, qui ne seront pas de simples remplacements de couleurs. N'h√©sitez pas √† jouer avec les filtres CSS, et tout particuli√®rement `brightness` pour faire vos derniers ajustements, ils vous seront d'une grande aide pour ne pas avoir √† cr√©er d'assets suppl√©mentaires, par exemple‚Ä¶

## Liens :

[The past, present, and future of Dark Mode](https://uxdesign.cc/the-past-present-and-future-of-dark-mode-9254f2956ec7)
[Can I Use ? prefers-color-scheme](https://caniuse.com/#feat=prefers-color-scheme)
[Can I Use ? matchMedia](https://caniuse.com/#search=matchMedia)